version: '3.5'
services:

  xcolab_mysql:
    image: mysql/mysql-server:5.7
    environment:
      - MYSQL_DATABASE=xcolab
      - MYSQL_USER=xcolab
      - MYSQL_PASSWORD=${MYSQL_PASSWORD?"Specify DB password for xcolab user in env MYSQL_PASSWORD"}
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD?"Specify DB password for root in env MYSQL_ROOT_PASSWORD"}
      - MYSQL_ROOT_HOST=127.0.0.1
    networks:
      - xcolab-network
    volumes:
      - './mysql/mysql_config:/etc/mysql'
      - '${DATABASE_PATH?"Specify DATABASE_PATH"}:/var/lib/mysql'

  database-starter-xcolab:
    image: mikirockerful/mysql_client
    environment:
      - MYSQL_PASSWORD=${MYSQL_PASSWORD?"Specify DB password for xcolab user in env MYSQL_PASSWORD"}
    volumes:
      - '../sql/starter/xcolab-data.sql:/xcolab-data.sql'
    command: sh -c "sleep 300 && mysql -h xcolab_mysql -u xcolab --password=$MYSQL_PASSWORD xcolab < /xcolab-data.sql"
    networks:
      - xcolab-network
    depends_on:
      - xcolab_mysql
      - activities-service-xcolab
      - admin-service-xcolab
      - comment-service-xcolab
      - content-service-xcolab
      - contest-service-xcolab
      - emails-service-xcolab
      - members-service-xcolab
      - modeling-service-xcolab
      - moderation-service-xcolab
      - search-service-xcolab
      - tracking-service-xcolab

  apache-xcolab:
    build: ./apache
    ports:
      - "80:80"
      - "443:443"
    networks:
      - xcolab-network
    depends_on:
      - view-xcolab
